<VirtualHost *:443>
    ServerName tropical.nigerdev.com
    ServerAlias www.tropical.nigerdev.com

    # IMPORTANT: Changer vers le bon dossier - soit out/ soit modifier pour pointer vers dist/
    DocumentRoot /var/www/tropical/out

    <Directory /var/www/tropical/out>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Gestion des erreurs personnalisée
        ErrorDocument 404 /404.html
        
        # Types MIME pour Next.js
        AddType application/javascript .js
        AddType text/css .css
        AddType image/svg+xml .svg
    </Directory>

    # Headers de sécurité
    <IfModule mod_headers.c>
        Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set X-Frame-Options "SAMEORIGIN"
        
        # Headers pour les assets statiques
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2)$">
            Header set Cache-Control "public, max-age=31536000, immutable"
        </FilesMatch>
    </IfModule>

    SSLEngine On
    SSLCertificateFile /etc/letsencrypt/live/tropical.nigerdev.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/tropical.nigerdev.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    ErrorLog ${APACHE_LOG_DIR}/tropical_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/tropical_ssl_access.log combined
    
    # Niveaux de logs pour débugger si besoin
    LogLevel warn rewrite:trace1
</VirtualHost>

# Alternative si vous voulez garder le dossier 'dist'
# Dans ce cas, copiez le contenu de 'out/' vers 'dist/'
<VirtualHost *:443>
    ServerName tropical-alt.nigerdev.com
    
    DocumentRoot /var/www/tropical/dist

    <Directory /var/www/tropical/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        ErrorDocument 404 /404.html
    </Directory>

    # Même configuration SSL et headers que ci-dessus
</VirtualHost>